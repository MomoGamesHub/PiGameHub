<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Domino Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap');
        :root { --bone: #f0f0f0; --gold: #ffd700; --table: #1a4731; }
        
        body { font-family: 'Cairo', sans-serif; background: #050505; color: white; margin: 0; overflow: hidden; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #table { 
            height: 100vh; display: flex; flex-direction: column; 
            background: radial-gradient(circle, #2d5a44 0%, #1a3a2a 100%); 
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† - ØªØ¶Ù…Ù† Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        .board-container { 
            flex: 1; position: relative; overflow: auto; 
            display: flex; align-items: center; justify-content: center;
            padding: 50px;
        }

        #domino-chain { 
            display: flex; align-items: center; gap: 4px; 
            padding: 20px; border-radius: 10px; background: rgba(0,0,0,0.2);
            min-height: 100px; transition: all 0.5s ease;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø·Ø¹Ø© - Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆÙˆØ§Ø¶Ø­ */
        .tile { 
            width: 35px; height: 70px; background: var(--bone); border-radius: 4px; 
            display: flex; flex-direction: column; box-shadow: 2px 4px 8px rgba(0,0,0,0.5);
            border: 1px solid #999; flex-shrink: 0; cursor: pointer; position: relative;
        }
        .tile.horizontal { transform: rotate(90deg); margin: 0 15px; }
        
        .half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); padding: 4px; gap: 2px; }
        .dot { background: #222; border-radius: 50%; width: 5px; height: 5px; visibility: hidden; align-self: center; justify-self: center; }
        .line { height: 1px; background: #ccc; width: 80%; margin: 0 auto; }
        
        /* ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· */
        .d-1 .dot:nth-child(5), .d-2 .dot:nth-child(1), .d-2 .dot:nth-child(9),
        .d-3 .dot:nth-child(1), .d-3 .dot:nth-child(5), .d-3 .dot:nth-child(9),
        .d-4 .dot:nth-child(1), .d-4 .dot:nth-child(3), .d-4 .dot:nth-child(7), .d-4 .dot:nth-child(9),
        .d-5 .dot:nth-child(1), .d-5 .dot:nth-child(3), .d-5 .dot:nth-child(5), .d-5 .dot:nth-child(7), .d-5 .dot:nth-child(9),
        .d-6 .dot:nth-child(1), .d-6 .dot:nth-child(3), .d-6 .dot:nth-child(4), .d-6 .dot:nth-child(6), .d-6 .dot:nth-child(7), .d-6 .dot:nth-child(9) 
        { visibility: visible; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .gui { background: rgba(0,0,0,0.9); padding: 15px; border-top: 3px solid var(--gold); z-index: 100; }
        .player-hand { display: flex; gap: 10px; justify-content: center; height: 80px; margin-bottom: 10px; }
        .player-hand .tile { transform: rotate(0deg); border: 2px solid transparent; }
        .player-hand .tile:hover { border-color: var(--gold); transform: translateY(-10px); }

        .controls { display: flex; justify-content: space-between; align-items: center; max-width: 800px; margin: 0 auto; }
        .btn { background: var(--gold); color: #000; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #555; color: #aaa; cursor: not-allowed; }
        
        .info-panel { background: #222; padding: 5px 15px; border-radius: 20px; border: 1px solid var(--gold); font-size: 0.9rem; }
    </style>
</head>
<body>

<div id="table">
    <div style="display:flex; justify-content: space-between; padding: 10px 20px; background: rgba(0,0,0,0.5);">
        <div class="info-panel">ğŸ† Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="pScore">0</span> / 101</div>
        <div id="status" style="color:var(--gold)">Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†</div>
        <div class="info-panel">Ø§Ù„Ø£Ø·Ø±Ø§Ù: <b id="L">ØŸ</b> | <b id="R">ØŸ</b></div>
    </div>

    <div class="board-container">
        <div id="domino-chain"></div>
    </div>

    <div class="gui">
        <div class="player-hand" id="hand"></div>
        <div class="controls">
            <button class="btn" id="drawBtn" onclick="draw()">Ø³Ø­Ø¨ (<span id="bCount"></span>)</button>
            <button class="btn" id="passBtn" onclick="pass()" disabled>ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ± (Pass)</button>
        </div>
    </div>
</div>

<script>
    let player = [], ai = [], boneyard = [], chain = [];
    let leftSide = -1, rightSide = -1, scores = { p: 0, ai: 0 };

    function createTileUI(a, b, isTable = false) {
        const div = document.createElement('div');
        div.className = `tile ${isTable ? 'horizontal' : ''}`;
        div.innerHTML = `<div class="half d-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div><div class="line"></div><div class="half d-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>`;
        return div;
    }

    function init() {
        let deck = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) deck.push({a:i, b:j});
        deck.sort(() => Math.random() - 0.5);
        player = deck.splice(0, 7); ai = deck.splice(0, 7); boneyard = deck;
        chain = []; leftSide = -1; rightSide = -1;
        render();
    }

    function render() {
        const h = document.getElementById('hand'); h.innerHTML = '';
        player.forEach((t, i) => {
            const el = createTileUI(t.a, t.b);
            el.onclick = () => play(i);
            h.appendChild(el);
        });

        const c = document.getElementById('domino-chain'); c.innerHTML = '';
        chain.forEach(t => c.appendChild(createTileUI(t.a, t.b, true)));

        document.getElementById('L').innerText = leftSide === -1 ? 'ØŸ' : leftSide;
        document.getElementById('R').innerText = rightSide === -1 ? 'ØŸ' : rightSide;
        document.getElementById('bCount').innerText = boneyard.length;
        document.getElementById('pScore').innerText = scores.p;

        validateControls();
    }

    function play(idx) {
        let t = player[idx];
        let ok = false;

        if (leftSide === -1) { 
            leftSide = t.a; rightSide = t.b; chain.push(t); ok = true; 
        } else if (t.a === leftSide || t.b === leftSide) {
            if (t.a === leftSide) [t.a, t.b] = [t.b, t.a];
            leftSide = t.a; chain.unshift(t); ok = true;
        } else if (t.a === rightSide || t.b === rightSide) {
            if (t.b === rightSide) [t.a, t.b] = [t.b, t.a];
            rightSide = t.b; chain.push(t); ok = true;
        }

        if (ok) {
            player.splice(idx, 1);
            render();
            if (player.length === 0) return end('player');
            document.getElementById('status').innerText = "Ø§Ù„Ø®ØµÙ… ÙŠÙ„Ø¹Ø¨...";
            setTimeout(aiPlay, 800);
        }
    }

    function aiPlay() {
        let idx = ai.findIndex(t => t.a === leftSide || t.b === leftSide || t.a === rightSide || t.b === rightSide);
        if (idx !== -1) {
            let t = ai[idx];
            if (t.a === leftSide || t.b === leftSide) {
                if (t.a === leftSide) [t.a, t.b] = [t.b, t.a];
                leftSide = t.a; chain.unshift(t);
            } else {
                if (t.b === rightSide) [t.a, t.b] = [t.b, t.a];
                rightSide = t.b; chain.push(t);
            }
            ai.splice(idx, 1);
            if (ai.length === 0) return end('ai');
        } else if (boneyard.length > 0) {
            ai.push(boneyard.shift());
            return aiPlay();
        }
        document.getElementById('status').innerText = "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†";
        render();
    }

    function validateControls() {
        const canPlay = player.some(t => t.a === leftSide || t.b === leftSide || t.a === rightSide || t.b === rightSide || leftSide === -1);
        document.getElementById('passBtn').disabled = (canPlay || boneyard.length > 0);
        
        // Ø§Ù„Ù‚ÙÙ„Ø© (Block)
        const aiCanPlay = ai.some(t => t.a === leftSide || t.b === leftSide || t.a === rightSide || t.b === rightSide);
        if (!canPlay && !aiCanPlay && boneyard.length === 0) {
            let pSum = player.reduce((s, t) => s + t.a + t.b, 0);
            let aiSum = ai.reduce((s, t) => s + t.a + t.b, 0);
            alert(`Ù‚ÙÙ„Ø©! Ù†Ù‚Ø§Ø·Ùƒ: ${pSum}, Ø§Ù„Ø®ØµÙ…: ${aiSum}`);
            end(pSum < aiSum ? 'player' : 'ai');
        }
    }

    function draw() { if(boneyard.length > 0) { player.push(boneyard.shift()); render(); } }
    function pass() { document.getElementById('status').innerText = "Ù…Ø±Ø±Øª Ø§Ù„Ø¯ÙˆØ±"; setTimeout(aiPlay, 500); }

    function end(winner) {
        let pts = 0;
        if (winner === 'player') ai.forEach(t => pts += (t.a + t.b));
        else player.forEach(t => pts += (t.a + t.b));
        scores[winner === 'player' ? 'p' : 'ai'] += pts;
        alert(`ÙØ§Ø² ${winner === 'player' ? 'Ø§Ù„Ù„Ø§Ø¹Ø¨' : 'Ø§Ù„Ø®ØµÙ…'} Ø¨Ù€ ${pts} Ù†Ù‚Ø·Ø©`);
        if(scores.p >= 101) alert("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!");
        init();
    }

    init();
</script>
</body>
</html>
