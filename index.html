<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ÙˆØ§Ø¬Ù‡Ø© Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <style>
        /* --- 1. Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨ØµØ±ÙŠ (The UI) --- */
        :root {
            --wood: #2c1b0e;
            --table-green: #155843;
            --tile-white: #fdfdfd;
            --accent: #ffcc00;
        }

        body {
            margin: 0; background: #050505; color: white;
            font-family: 'Cairo', sans-serif; overflow: hidden;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #game-canvas {
            height: 70vh; width: 100vw;
            background: 
                radial-gradient(circle at center, var(--table-green) 0%, #0a2b20 100%),
                url('https://www.transparenttextures.com/patterns/felt.png'); /* Ù…Ù„Ù…Ø³ Ù‚Ù…Ø§Ø´ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© */
            display: flex; align-items: center; justify-content: center;
            overflow: auto; border-bottom: 5px solid var(--wood);
            box-shadow: inset 0 0 100px rgba(0,0,0,0.8);
        }

        #domino-stream {
            display: flex; align-items: center; gap: 10px; padding: 150px;
            min-width: min-content; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }

        /* ØªØµÙ…ÙŠÙ… ÙˆØ±Ù‚Ø© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ */
        .tile {
            width: 45px; height: 90px; background: var(--tile-white);
            border-radius: 8px; display: flex; flex-direction: column;
            position: relative; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 3px solid #ddd; border-bottom: 3px solid #ccc;
            user-select: none;
        }

        .tile.on-table { transform: rotate(90deg); margin: 0 18px; }

        /* Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ±Ù‚Ø© */
        .side { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); padding: 7px; }
        .dot { background: #1a1a1a; border-radius: 50%; width: 7px; height: 7px; visibility: hidden; align-self: center; justify-self: center; }
        .middle-line { height: 2px; background: rgba(0,0,0,0.08); width: 80%; margin: 0 auto; }

        /* ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· (CSS Classes) */
        .p-1 .dot:nth-child(5), .p-2 .dot:nth-child(1), .p-2 .dot:nth-child(9),
        .p-3 .dot:nth-child(1), .p-3 .dot:nth-child(5), .p-3 .dot:nth-child(9),
        .p-4 .dot:nth-child(1), .p-4 .dot:nth-child(3), .p-4 .dot:nth-child(7), .p-4 .dot:nth-child(9),
        .p-5 .dot:nth-child(1), .p-5 .dot:nth-child(3), .p-5 .dot:nth-child(5), .p-5 .dot:nth-child(7), .p-5 .dot:nth-child(9),
        .p-6 .dot:nth-child(1), .p-6 .dot:nth-child(3), .p-6 .dot:nth-child(4), .p-6 .dot:nth-child(6), .p-6 .dot:nth-child(7), .p-6 .dot:nth-child(9) 
        { visibility: visible; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙŠØ¯ ÙˆØ§Ù„ØªØ­ÙƒÙ… (HUD) */
        .player-bar {
            height: 30vh; background: linear-gradient(to bottom, #1a1a1a, #000);
            display: flex; flex-direction: column; align-items: center; justify-content: space-around;
        }

        .hand-container {
            display: flex; gap: 12px; padding: 10px 30px;
            background: rgba(255,255,255,0.03); border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .tile.in-hand:hover {
            transform: translateY(-20px) scale(1.1);
            z-index: 10; box-shadow: 0 15px 30px rgba(0,0,0,0.5);
            border-color: var(--accent);
        }

        .playable { border: 2px solid var(--accent) !important; cursor: pointer; }
        .locked { opacity: 0.4; filter: grayscale(0.8); pointer-events: none; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        .controls { display: flex; gap: 20px; align-items: center; }
        .score-board { font-size: 1.1rem; color: var(--accent); background: #222; padding: 5px 20px; border-radius: 50px; border: 1px solid #444; }
        .btn-play {
            background: var(--accent); color: #000; border: none; padding: 12px 30px;
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .btn-play:hover:not(:disabled) { transform: scale(1.05); background: #fff; }
        .btn-play:disabled { background: #333; color: #777; }

    </style>
</head>
<body>

<div id="game-canvas">
    <div id="domino-stream"></div>
</div>

<div class="player-bar">
    <div class="score-board">
        ğŸ‘¤ Ø£Ù†Øª: <span id="pScore">0</span> | ğŸ¤– Ø§Ù„Ø®ØµÙ…: <span id="aiScore">0</span> | ğŸ´ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="bCount">0</span>
    </div>

    <div class="hand-container" id="myHand"></div>

    <div class="controls">
        <button class="btn-play" id="drawBtn" onclick="drawTile()">Ø³Ø­Ø¨ ÙˆØ±Ù‚Ø©</button>
        <button class="btn-play" id="passBtn" onclick="passTurn()" disabled>ØªÙ…Ø±ÙŠØ±</button>
    </div>
</div>

<script>
    /* --- 2. Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (The Engine) --- */
    let boneyard = [], pHand = [], aiHand = [], chain = [];
    let L = -1, R = -1, scores = {p:0, ai:0};

    function init() {
        boneyard = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) boneyard.push({a:i, b:j});
        boneyard.sort(() => Math.random() - 0.5);
        pHand = boneyard.splice(0, 7);
        aiHand = boneyard.splice(0, 7);
        render();
    }

    function createTileUI(a, b, onTable) {
        const d = document.createElement('div');
        d.className = `tile ${onTable ? 'on-table' : 'in-hand'}`;
        d.innerHTML = `<div class="side p-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div>
                       <div class="middle-line"></div>
                       <div class="side p-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>`;
        return d;
    }

    function render() {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯
        const h = document.getElementById('myHand');
        h.innerHTML = '';
        pHand.forEach((t, i) => {
            const canPlay = (L === -1 || t.a === L || t.b === L || t.a === R || t.b === R);
            const el = createTileUI(t.a, t.b, false);
            el.classList.add(canPlay ? 'playable' : 'locked');
            el.onclick = () => play(i);
            h.appendChild(el);
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§ÙˆÙ„Ø©
        const s = document.getElementById('domino-stream');
        s.innerHTML = '';
        chain.forEach(t => s.appendChild(createTileUI(t.a, t.b, true)));

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        document.getElementById('bCount').innerText = boneyard.length;
        document.getElementById('pScore').innerText = scores.p;
        document.getElementById('aiScore').innerText = scores.ai;

        // ØªÙ…Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ
        setTimeout(() => { document.getElementById('game-canvas').scrollLeft = 5000; }, 100);
        
        checkGameStatus();
    }

    function play(idx) {
        let t = pHand[idx];
        let ok = false;
        if (L === -1) { L=t.a; R=t.b; chain.push(t); ok=true; }
        else if (t.a === L || t.b === L) { if(t.a===L) [t.a,t.b]=[t.b,t.a]; L=t.a; chain.unshift(t); ok=true; }
        else if (t.a === R || t.b === R) { if(t.b===R) [t.a,t.b]=[t.b,t.a]; R=t.b; chain.push(t); ok=true; }
        
        if (ok) {
            pHand.splice(idx, 1);
            if (pHand.length === 0) return endRound('p');
            render();
            setTimeout(aiMove, 1000);
        }
    }

    function aiMove() {
        let idx = aiHand.findIndex(t => t.a === L || t.b === L || t.a === R || t.b === R);
        if (idx !== -1) {
            let t = aiHand[idx];
            if (t.a === L || t.b === L) { if(t.a===L) [t.a,t.b]=[t.b,t.a]; L=t.a; chain.unshift(t); }
            else { if(t.b===R) [t.a,t.b]=[t.b,t.a]; R=t.b; chain.push(t); }
            aiHand.splice(idx, 1);
            if (aiHand.length === 0) return endRound('ai');
        } else if (boneyard.length > 0) {
            aiHand.push(boneyard.shift());
            return aiMove();
        }
        render();
    }

    function checkGameStatus() {
        const canP = pHand.some(t => t.a === L || t.b === L || t.a === R || t.b === R || L === -1);
        const canAI = aiHand.some(t => t.a === L || t.b === L || t.a === R || t.b === R);
        document.getElementById('drawBtn').disabled = (boneyard.length === 0);
        document.getElementById('passBtn').disabled = (canP || boneyard.length > 0);
        
        if (!canP && !canAI && boneyard.length === 0 && L !== -1) {
            let pS = pHand.reduce((s,t)=>s+t.a+t.b, 0);
            let aS = aiHand.reduce((s,t)=>s+t.a+t.b, 0);
            alert(`Ù‚ÙÙ„Ø©! Ù†Ù‚Ø§Ø·Ùƒ: ${pS} - Ø§Ù„Ø®ØµÙ…: ${aS}`);
            endRound(pS < aS ? 'p' : 'ai');
        }
    }

    function drawTile() { if(boneyard.length > 0) { pHand.push(boneyard.shift()); render(); } }
    function passTurn() { setTimeout(aiMove, 400); }

    function endRound(win) {
        let p = (win==='p') ? aiHand.reduce((s,t)=>s+t.a+t.b,0) : pHand.reduce((s,t)=>s+t.a+t.b,0);
        scores[win] += p;
        alert(`ÙØ§Ø² ${win==='p'?'Ø§Ù„Ù„Ø§Ø¹Ø¨':'Ø§Ù„Ø®ØµÙ…'} Ø¨Ù€ ${p} Ù†Ù‚Ø·Ø©`);
        chain=[]; L=-1; R=-1; init();
    }

    init();
</script>
</body>
</html>
