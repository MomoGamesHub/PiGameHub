<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Domino Pro | Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        :root { --pi-color: #ffa500; --bg-dark: #0f0a1e; --table-green: #064e3b; }
        
        body { font-family: 'Cairo', sans-serif; background: var(--bg-dark); color: white; margin: 0; overflow: hidden; }

        /* Lobby Style */
        #lobby { position: fixed; inset: 0; background: var(--bg-dark); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .lobby-card { background: var(--card-bg); padding: 40px; border-radius: 30px; border: 2px solid var(--pi-color); box-shadow: 0 0 30px rgba(255,165,0,0.2); }

        /* Table & Snake Layout */
        #gameArena { height: 100vh; display: none; flex-direction: column; background: radial-gradient(circle, #065f46 0%, #042f2e 100%); }
        .domino-table { flex: 1; padding: 40px; display: flex; align-items: center; justify-content: center; overflow: auto; perspective: 1000px; }
        #snakeContainer { display: flex; align-items: center; gap: 4px; flex-wrap: wrap; justify-content: center; max-width: 80%; }

        /* Real Domino Look */
        .tile { 
            width: 40px; height: 80px; background: #fdfdfd; color: black; border-radius: 4px;
            display: flex; flex-direction: column; box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
            cursor: pointer; position: relative; border: 1px solid #999;
        }
        .tile-half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); padding: 4px; gap: 2px; }
        .dot { background: #222; border-radius: 50%; width: 6px; height: 6px; visibility: hidden; align-self: center; justify-self: center; }
        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· - Ù…Ø«Ø§Ù„ Ù„Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ³Ø·Ù‰ */
        .val-1 .dot:nth-child(5) { visibility: visible; }
        .line { height: 2px; background: #333; width: 80%; margin: 0 auto; }
        
        .tile.horizontal { transform: rotate(90deg); margin: 0 -20px; }

        /* Indicators */
        .ends-info { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; }
        .end-box { background: rgba(255,165,0,0.2); border: 1px solid var(--pi-color); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; }

        .hand-area { background: rgba(0,0,0,0.6); padding: 20px; border-radius: 40px 40px 0 0; }
        .hand { display: flex; gap: 10px; justify-content: center; height: 90px; }
    </style>
</head>
<body>

<div id="lobby">
    <div class="lobby-card">
        <div style="font-size: 4rem;">ğŸ€„</div>
        <h1 style="color:var(--pi-color)">ØºØ±ÙØ© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h1>
        <p>Ø§Ù„Ø±Ù‡Ø§Ù†: 100 Ï€ | Ø§Ù„Ù‡Ø¯Ù: 101 Ù†Ù‚Ø·Ø©</p>
        <button onclick="startGame()" style="background:var(--pi-color); border:none; padding:15px 40px; border-radius:25px; font-weight:bold; cursor:pointer; font-size:1.2rem;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
    </div>
</div>

<div id="gameArena">
    <div class="game-header" style="display:flex; justify-content:space-between; padding:15px;">
        <div class="end-box">ğŸ‘¤ Ø£Ù†Øª: <span id="pScore">0</span> | ğŸ¤– Ø§Ù„Ø®ØµÙ…: <span id="aiScore">0</span></div>
        <div class="ends-info">
            <div class="end-box">Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠÙ…Ù†: <b id="rightEnd">-</b></div>
            <div class="end-box">Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠØ³Ø±: <b id="leftEnd">-</b></div>
        </div>
        <button onclick="location.reload()" style="background:#ef4444; border:none; border-radius:10px; padding:5px 15px; color:white;">Ø§Ù†Ø³Ø­Ø§Ø¨</button>
    </div>

    <div class="domino-table">
        <div id="snakeContainer">
            </div>
    </div>

    <div class="hand-area">
        <div style="text-align:center; margin-bottom:10px;">
            <button class="end-box" id="drawBtn" onclick="drawFromBoneyard()" style="cursor:pointer">Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (<span id="boneCount">14</span>)</button>
        </div>
        <div class="hand" id="playerHand"></div>
    </div>
</div>

<script>
    let playerHand = [], aiHand = [], boneyard = [], tableTiles = [];
    let leftValue = -1, rightValue = -1;
    let scores = { player: 0, ai: 0 };

    function createTileElement(a, b, isHorizontal = false) {
        const tile = document.createElement('div');
        tile.className = `tile ${isHorizontal ? 'horizontal' : ''}`;
        tile.innerHTML = `
            <div class="tile-half val-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div>
            <div class="line"></div>
            <div class="tile-half val-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>
        `;
        // ÙƒÙˆØ¯ Ø¨Ø³ÙŠØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…
        applyDots(tile.querySelectorAll('.tile-half')[0], a);
        applyDots(tile.querySelectorAll('.tile-half')[1], b);
        return tile;
    }

    function applyDots(half, val) {
        const dots = half.querySelectorAll('.dot');
        const patterns = {
            0: [], 1: [4], 2: [0, 8], 3: [0, 4, 8], 4: [0, 2, 6, 8], 
            5: [0, 2, 4, 6, 8], 6: [0, 3, 6, 2, 5, 8]
        };
        patterns[val].forEach(idx => dots[idx].style.visibility = 'visible');
    }

    function startGame() {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('gameArena').style.display = 'flex';
        initRound();
    }

    function initRound() {
        const deck = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) deck.push({a:i, b:j});
        deck.sort(() => Math.random() - 0.5);
        
        playerHand = deck.splice(0, 7);
        aiHand = deck.splice(0, 7);
        boneyard = deck;
        tableTiles = [];
        leftValue = -1; rightValue = -1;
        
        renderHand();
        updateUI();
    }

    function renderHand() {
        const handDiv = document.getElementById('playerHand');
        handDiv.innerHTML = '';
        playerHand.forEach((t, i) => {
            const el = createTileElement(t.a, t.b);
            el.onclick = () => tryPlay(t, i);
            handDiv.appendChild(el);
        });
    }

    function tryPlay(tile, index) {
        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
        if (leftValue === -1) { // Ø£ÙˆÙ„ Ù‚Ø·Ø¹Ø©
            leftValue = tile.a; rightValue = tile.b;
            addToTable(tile, 'right');
        } else if (tile.a === leftValue || tile.b === leftValue) {
            if(tile.a === leftValue) { leftValue = tile.b; } else { leftValue = tile.a; }
            addToTable(tile, 'left');
        } else if (tile.a === rightValue || tile.b === rightValue) {
            if(tile.a === rightValue) { rightValue = tile.b; } else { rightValue = tile.a; }
            addToTable(tile, 'right');
        } else {
            alert("Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø·Ø¹Ø© Ù„Ø§ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø·Ø±Ø§Ù!");
            return;
        }

        playerHand.splice(index, 1);
        renderHand();
        updateUI();
        setTimeout(aiPlay, 1000);
    }

    function addToTable(tile, side) {
        const container = document.getElementById('snakeContainer');
        const el = createTileElement(tile.a, tile.b, true);
        if(side === 'left') container.prepend(el);
        else container.appendChild(el);
    }

    function updateUI() {
        document.getElementById('leftEnd').innerText = leftValue === -1 ? "?" : leftValue;
        document.getElementById('rightEnd').innerText = rightValue === -1 ? "?" : rightValue;
        document.getElementById('boneCount').innerText = boneyard.length;
    }

    function drawFromBoneyard() {
        if(boneyard.length > 0) {
            playerHand.push(boneyard.shift());
            renderHand();
            updateUI();
        }
    }

    function aiPlay() {
        // Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø³ÙŠØ· ÙŠØ¨Ø­Ø« Ø¹Ù† Ù…Ø·Ø§Ø¨Ù‚Ø©
        const moveIndex = aiHand.findIndex(t => t.a === leftValue || t.b === leftValue || t.a === rightValue || t.b === rightValue);
        if(moveIndex !== -1) {
            const t = aiHand[moveIndex];
            if(t.a === leftValue || t.b === leftValue) {
                leftValue = (t.a === leftValue) ? t.b : t.a;
                addToTable(t, 'left');
            } else {
                rightValue = (t.a === rightValue) ? t.b : t.a;
                addToTable(t, 'right');
            }
            aiHand.splice(moveIndex, 1);
            updateUI();
        }
    }
</script>
</body>
</html>
