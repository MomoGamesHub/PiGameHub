<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ… | Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ù„Ø³Ø©</title>
    <style>
        :root { 
            --bg: #0f2027; 
            --table-grad: radial-gradient(circle, #203a43, #2c5364);
            --gold: #fcc200;
            --tile: #fcfaf1;
        }

        body { 
            margin: 0; background: var(--bg); color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden; 
        }

        /* Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø¹Ù…Ù‚ */
        #game-world {
            height: 65vh; width: 100vw; overflow: auto;
            background: var(--table-grad);
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px;
            scroll-behavior: smooth;
        }

        #snake-chain {
            display: flex; align-items: center; gap: 8px; padding: 120px;
            min-width: min-content;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± */
        .domino {
            width: 42px; height: 84px; background: var(--tile);
            border-radius: 6px; display: flex; flex-direction: column;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3), inset 0 0 5px rgba(0,0,0,0.1);
            border: 1px solid #d1d1d1; flex-shrink: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            from { transform: scale(0) rotate(-10deg); opacity: 0; }
            to { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .on-table { transform: rotate(90deg); margin: 0 15px; border-bottom: 4px solid #bbb; }

        /* Ø§Ù„Ù†Ù‚Ø§Ø· */
        .half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); padding: 6px; }
        .dot { background: #222; border-radius: 50%; width: 7px; height: 7px; visibility: hidden; align-self: center; justify-self: center; }
        .line { height: 1px; background: rgba(0,0,0,0.1); width: 85%; margin: 0 auto; }
        .v-1 .dot:nth-child(5), .v-2 .dot:nth-child(1), .v-2 .dot:nth-child(9),
        .v-3 .dot:nth-child(1), .v-3 .dot:nth-child(5), .v-3 .dot:nth-child(9),
        .v-4 .dot:nth-child(1), .v-4 .dot:nth-child(3), .v-4 .dot:nth-child(7), .v-4 .dot:nth-child(9),
        .v-5 .dot:nth-child(1), .v-5 .dot:nth-child(3), .v-5 .dot:nth-child(5), .v-5 .dot:nth-child(7), .v-5 .dot:nth-child(9),
        .v-6 .dot:nth-child(1), .v-6 .dot:nth-child(3), .v-6 .dot:nth-child(4), .v-6 .dot:nth-child(6), .v-6 .dot:nth-child(7), .v-6 .dot:nth-child(9) 
        { visibility: visible; }

        /* ÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ (UI) */
        .hud { height: 35vh; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; border-top: 2px solid rgba(255,255,255,0.1); }
        .hand { display: flex; gap: 12px; padding: 20px; }
        
        /* ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¹Ø¨ */
        .playable { box-shadow: 0 0 15px var(--gold); transform: translateY(-10px); border: 2px solid var(--gold); }
        .not-playable { opacity: 0.6; pointer-events: none; filter: grayscale(0.5); }

        .controls { display: flex; gap: 15px; margin-top: 10px; }
        .btn { 
            background: var(--gold); border: none; padding: 12px 25px; 
            font-weight: bold; cursor: pointer; border-radius: 30px; 
            box-shadow: 0 4px 0 #b8860b; transition: 0.2s;
        }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn:disabled { background: #555; box-shadow: none; color: #888; }
        
        .score-pill { background: rgba(255,255,255,0.1); padding: 5px 20px; border-radius: 20px; border: 1px solid var(--gold); margin: 10px; }
    </style>
</head>
<body>

<div id="game-world">
    <div id="snake-chain"></div>
</div>

<div class="hud">
    <div class="score-pill">
        ğŸ‘¤ <span id="pS">0</span> &nbsp; | &nbsp; ğŸ¤– <span id="aS">0</span> &nbsp; | &nbsp; ğŸ“¦ <span id="bC">0</span>
    </div>
    <div id="player-hand" class="hand"></div>
    <div class="controls">
        <button class="btn" id="drawBtn" onclick="drawTile()">Ø³Ø­Ø¨ ÙˆØ±Ù‚Ø©</button>
        <button class="btn" id="passBtn" onclick="passTurn()" disabled>ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±</button>
    </div>
</div>

<script>
    // --- Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶) ---
    let boneyard = [], pHand = [], aiHand = [], chain = [];
    let L = -1, R = -1, scores = {p:0, ai:0};

    function init() {
        boneyard = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) boneyard.push({a:i, b:j});
        boneyard.sort(() => Math.random() - 0.5);
        pHand = boneyard.splice(0, 7);
        aiHand = boneyard.splice(0, 7);
        render();
    }

    function createUI(a, b, onTable) {
        const d = document.createElement('div');
        d.className = `domino ${onTable ? 'on-table' : ''}`;
        d.innerHTML = `<div class="half v-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div><div class="line"></div><div class="half v-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>`;
        return d;
    }

    function render() {
        const handDiv = document.getElementById('player-hand');
        handDiv.innerHTML = '';
        pHand.forEach((t, i) => {
            const isPlayable = (L === -1 || t.a === L || t.b === L || t.a === R || t.b === R);
            const el = createUI(t.a, t.b, false);
            el.className += isPlayable ? ' playable' : ' not-playable';
            el.onclick = () => play(i);
            handDiv.appendChild(el);
        });

        const chainDiv = document.getElementById('snake-chain');
        chainDiv.innerHTML = '';
        chain.forEach(t => chainDiv.appendChild(createUI(t.a, t.b, true)));

        document.getElementById('bC').innerText = boneyard.length;
        document.getElementById('pS').innerText = scores.p;
        document.getElementById('aS').innerText = scores.ai;

        // ØªÙ…Ø±ÙŠØ± Ø³Ù„Ø³ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ù†Ø´Ø·
        setTimeout(() => {
            const world = document.getElementById('game-world');
            world.scrollLeft = world.scrollWidth;
        }, 100);

        checkRules();
    }

    // (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„: play, aiMove, checkRules, drawTile, endRound ØªØ¸Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
    function play(idx) {
        let t = pHand[idx];
        let played = false;
        if (L === -1) { L = t.a; R = t.b; chain.push(t); played = true; } 
        else if (t.a === L || t.b === L) { if (t.a === L) [t.a, t.b] = [t.b, t.a]; L = t.a; chain.unshift(t); played = true; } 
        else if (t.a === R || t.b === R) { if (t.b === R) [t.a, t.b] = [t.b, t.a]; R = t.b; chain.push(t); played = true; }
        
        if (played) {
            pHand.splice(idx, 1);
            if (pHand.length === 0) return endRound('p');
            render();
            setTimeout(aiMove, 1000);
        }
    }

    function aiMove() {
        let idx = aiHand.findIndex(t => t.a === L || t.b === L || t.a === R || t.b === R);
        if (idx !== -1) {
            let t = aiHand[idx];
            if (t.a === L || t.b === L) { if (t.a === L) [t.a, t.b] = [t.b, t.a]; L = t.a; chain.unshift(t); } 
            else { if (t.b === R) [t.a, t.b] = [t.b, t.a]; R = t.b; chain.push(t); }
            aiHand.splice(idx, 1);
            if (aiHand.length === 0) return endRound('ai');
        } else if (boneyard.length > 0) {
            aiHand.push(boneyard.shift());
            return aiMove();
        }
        render();
    }

    function checkRules() {
        const canP = pHand.some(t => t.a === L || t.b === L || t.a === R || t.b === R || L === -1);
        const canAI = aiHand.some(t => t.a === L || t.b === L || t.a === R || t.b === R);
        document.getElementById('drawBtn').disabled = (boneyard.length === 0);
        document.getElementById('passBtn').disabled = (canP || boneyard.length > 0);
        if (!canP && !canAI && boneyard.length === 0 && L !== -1) {
            let pSum = pHand.reduce((s, t) => s + t.a + t.b, 0);
            let aiSum = aiHand.reduce((s, t) => s + t.a + t.b, 0);
            alert(`Ø§Ù„Ù‚ÙÙ„Ø©! Ù…Ø¬Ù…ÙˆØ¹Ùƒ: ${pSum} | Ø§Ù„Ø®ØµÙ…: ${aiSum}`);
            endRound(pSum < aiSum ? 'p' : 'ai');
        }
    }

    function drawTile() { if(boneyard.length > 0) { pHand.push(boneyard.shift()); render(); } }
    function passTurn() { setTimeout(aiMove, 400); }

    function endRound(winner) {
        let pts = (winner === 'p') ? aiHand.reduce((s, t) => s + t.a + t.b, 0) : pHand.reduce((s, t) => s + t.a + t.b, 0);
        scores[winner] += pts;
        alert(`ÙØ§Ø² ${winner==='p'?'Ø£Ù†Øª':'Ø§Ù„Ø®ØµÙ…'} Ø¨Ù€ ${pts} Ù†Ù‚Ø·Ø©!`);
        chain = []; L = -1; R = -1; init();
    }

    init();
</script>
</body>
</html>
