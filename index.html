<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Domino | Snake Path Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        :root { --pi-orange: #ffa500; --table-green: #064e3b; --bg-dark: #0f0a1e; }
        
        body { font-family: 'Cairo', sans-serif; background: var(--bg-dark); color: white; margin: 0; overflow: hidden; }

        /* Ø§Ù„Ù„ÙˆØ¨ÙŠ */
        #lobby { position: fixed; inset: 0; background: var(--bg-dark); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .lobby-box { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; border: 2px solid var(--pi-orange); text-align: center; }
        
        /* Ø§Ù„Ø·Ø§ÙˆÙ„Ø© */
        #gameScreen { display: none; height: 100vh; flex-direction: column; background: radial-gradient(circle, #0a5a46 0%, #042f2e 100%); }
        .header { display: flex; justify-content: space-between; padding: 15px; background: rgba(0,0,0,0.5); z-index: 10; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† - ØªØ±ØªÙŠØ¨ Ù…Ø±Ù† */
        .table-area { 
            flex: 1; position: relative; overflow: auto; padding: 40px;
            display: flex; align-items: center; justify-content: center;
        }
        #snake { 
            display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; 
            max-width: 85%; transition: all 0.5s ease;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ */
        .domino { 
            width: 35px; height: 70px; background: #fdfdfd; border-radius: 4px; 
            display: flex; flex-direction: column; box-shadow: 2px 2px 6px rgba(0,0,0,0.4);
            border: 1px solid #bbb; flex-shrink: 0; transition: transform 0.3s;
        }
        .domino.horizontal { transform: rotate(90deg); margin: 0 10px; }
        .half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); padding: 4px; }
        .dot { background: #222; border-radius: 50%; width: 5px; height: 5px; visibility: hidden; align-self: center; justify-self: center; }
        .line { height: 1px; background: #ddd; width: 80%; margin: 0 auto; }
        
        /* ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· */
        .d-1 .dot:nth-child(5) { visibility: visible; }
        .d-2 .dot:nth-child(1), .d-2 .dot:nth-child(9) { visibility: visible; }
        .d-3 .dot:nth-child(1), .d-3 .dot:nth-child(5), .d-3 .dot:nth-child(9) { visibility: visible; }
        .d-4 .dot:nth-child(1), .d-4 .dot:nth-child(3), .d-4 .dot:nth-child(7), .d-4 .dot:nth-child(9) { visibility: visible; }
        .d-5 .dot:nth-child(1), .d-5 .dot:nth-child(3), .d-5 .dot:nth-child(5), .d-5 .dot:nth-child(7), .d-5 .dot:nth-child(9) { visibility: visible; }
        .d-6 .dot:nth-child(1), .d-6 .dot:nth-child(3), .d-6 .dot:nth-child(4), .d-6 .dot:nth-child(6), .d-6 .dot:nth-child(7), .d-6 .dot:nth-child(9) { visibility: visible; }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .controls { background: rgba(0,0,0,0.7); padding: 15px; border-top: 2px solid var(--pi-orange); }
        .hand { display: flex; gap: 8px; justify-content: center; padding: 10px; height: 80px; }
        .btn-action { background: var(--pi-orange); border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; color: #000; }
        .btn-action:disabled { background: #555; cursor: not-allowed; }

        /* Ø§Ù„Ø£Ø·Ø±Ø§Ù */
        .ends-display { font-weight: bold; color: var(--pi-orange); background: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px; }
    </style>
</head>
<body>

<div id="lobby">
    <div class="lobby-box">
        <h1>ğŸ€„ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†</h1>
        <p>ØªØ­Ø¯ÙŠ Ø§Ù„Ù€ 101 Ù†Ù‚Ø·Ø© | Pi Game Hub</p>
        <button class="btn-action" onclick="enterGame()" style="width:200px">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
    </div>
</div>

<div id="gameScreen">
    <div class="header">
        <div class="ends-display">Ø§Ù„Ø£Ø·Ø±Ø§Ù: <span id="lEnd">?</span> â†”ï¸ <span id="rEnd">?</span></div>
        <div>ğŸ’° <span id="pScoreUI">0</span> / 101</div>
        <button class="btn-action" style="background:#ff4444;" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="table-area">
        <div id="snake"></div>
    </div>

    <div class="controls">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button id="drawBtn" class="btn-action" onclick="playerDraw()">Ø³Ø­Ø¨ (<span id="boneCount">14</span>)</button>
            <div id="statusMsg" style="font-size:0.9rem;">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨...</div>
            <button id="passBtn" class="btn-action" onclick="playerPass()" disabled>ØªÙ…Ø±ÙŠØ± (Pass)</button>
        </div>
        <div class="hand" id="playerHand"></div>
    </div>
</div>

<script>
    let playerHand = [], aiHand = [], boneyard = [], table = [];
    let leftVal = -1, rightVal = -1;
    let scores = { player: 0, ai: 0 };

    function createDominoUI(a, b) {
        const div = document.createElement('div');
        div.className = 'domino horizontal';
        div.innerHTML = `<div class="half d-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div><div class="line"></div><div class="half d-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>`;
        return div;
    }

    function enterGame() {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'flex';
        initRound();
    }

    function initRound() {
        const deck = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) deck.push({a:i, b:j});
        deck.sort(() => Math.random() - 0.5);
        playerHand = deck.splice(0, 7);
        aiHand = deck.splice(0, 7);
        boneyard = deck;
        table = []; leftVal = -1; rightVal = -1;
        refreshAll();
    }

    function refreshAll() {
        renderHand();
        renderTable();
        updateUI();
        checkPassAvailability();
    }

    function renderHand() {
        const h = document.getElementById('playerHand');
        h.innerHTML = '';
        playerHand.forEach((t, i) => {
            const el = createDominoUI(t.a, t.b);
            el.classList.remove('horizontal');
            el.onclick = () => tryPlay(t, i);
            h.appendChild(el);
        });
    }

    function renderTable() {
        const s = document.getElementById('snake');
        s.innerHTML = '';
        table.forEach(t => s.appendChild(createDominoUI(t.a, t.b)));
    }

    function updateUI() {
        document.getElementById('lEnd').innerText = leftVal === -1 ? "?" : leftVal;
        document.getElementById('rEnd').innerText = rightVal === -1 ? "?" : rightVal;
        document.getElementById('boneCount').innerText = boneyard.length;
        document.getElementById('pScoreUI').innerText = scores.player;
    }

    function checkPassAvailability() {
        const canPlay = playerHand.some(t => t.a === leftVal || t.b === leftVal || t.a === rightVal || t.b === rightVal || leftVal === -1);
        document.getElementById('passBtn').disabled = (canPlay || boneyard.length > 0);
    }

    function tryPlay(tile, idx) {
        let side = '';
        if (leftVal === -1) side = 'first';
        else if (tile.a === leftVal || tile.b === leftVal) side = 'left';
        else if (tile.a === rightVal || tile.b === rightVal) side = 'right';

        if (!side) return;

        if (side === 'left') {
            if (tile.b !== leftVal) [tile.a, tile.b] = [tile.b, tile.a];
            leftVal = tile.a; table.unshift(tile);
        } else {
            if (side !== 'first' && tile.a !== rightVal) [tile.a, tile.b] = [tile.b, tile.a];
            rightVal = tile.b; if(side === 'first') leftVal = tile.a;
            table.push(tile);
        }

        playerHand.splice(idx, 1);
        refreshAll();
        if (playerHand.length === 0) return endRound('player');
        setTimeout(aiTurn, 1000);
    }

    function aiTurn() {
        let moveIdx = aiHand.findIndex(t => t.a === leftVal || t.b === leftVal || t.a === rightVal || t.b === rightVal);
        
        if (moveIdx === -1 && boneyard.length > 0) {
            aiHand.push(boneyard.shift());
            updateUI();
            return setTimeout(aiTurn, 500);
        }

        if (moveIdx !== -1) {
            const t = aiHand[moveIdx];
            if (t.a === leftVal || t.b === leftVal) {
                if (t.b !== leftVal) [t.a, t.b] = [t.b, t.a];
                leftVal = t.a; table.unshift(t);
            } else {
                if (t.a !== rightVal) [t.a, t.b] = [t.b, t.a];
                rightVal = t.b; table.push(t);
            }
            aiHand.splice(moveIdx, 1);
            refreshAll();
            if (aiHand.length === 0) return endRound('ai');
        } else {
            document.getElementById('statusMsg').innerText = "Ø§Ù„Ø®ØµÙ… Ù…Ø±Ø± Ø§Ù„Ø¯ÙˆØ± (Pass)";
        }
    }

    function playerDraw() {
        if (boneyard.length > 0) {
            playerHand.push(boneyard.shift());
            refreshAll();
        }
    }

    function playerPass() {
        document.getElementById('statusMsg').innerText = "Ù„Ù‚Ø¯ Ù…Ø±Ø±Øª Ø§Ù„Ø¯ÙˆØ±";
        setTimeout(aiTurn, 1000);
    }

    function endRound(winner) {
        let pts = 0;
        const loserHand = (winner === 'player' ? aiHand : playerHand);
        loserHand.forEach(t => pts += (t.a + t.b));
        scores[winner] += pts;
        
        alert(`${winner === 'player' ? 'Ø£Ù†Øª ÙØ²Øª' : 'Ø§Ù„Ø®ØµÙ… ÙØ§Ø²'} Ø¨Ù€ ${pts} Ù†Ù‚Ø·Ø©!`);
        
        if (scores[winner] >= 101) {
            alert("Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù†ØªÙ‡Øª!");
            location.reload();
        } else {
            initRound();
        }
    }
</script>
</body>
</html>
