<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† | Pi Game Hub</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        :root { --pi-orange: #ffa500; --table-green: #064e3b; --bg-dark: #0f0a1e; }
        
        body { font-family: 'Cairo', sans-serif; background: var(--bg-dark); color: white; margin: 0; overflow: hidden; }

        /* Ø§Ù„Ù„ÙˆØ¨ÙŠ */
        #lobby { position: fixed; inset: 0; background: var(--bg-dark); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .lobby-box { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; border: 2px solid var(--pi-orange); text-align: center; width: 80%; max-width: 400px; }
        
        /* Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        #gameScreen { display: none; height: 100vh; flex-direction: column; background: radial-gradient(circle, #0a5a46 0%, #042f2e 100%); }
        
        .header { display: flex; justify-content: space-between; padding: 15px; background: rgba(0,0,0,0.4); }
        .score-box { background: var(--pi-orange); color: black; padding: 5px 15px; border-radius: 10px; font-weight: bold; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† */
        .table-area { flex: 1; position: relative; overflow: auto; display: flex; align-items: center; justify-content: center; padding: 50px; }
        #snake { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; justify-content: center; transition: all 0.5s ease; }

        /* ØªØµÙ…ÙŠÙ… Ù‚Ø·Ø¹Ø© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ */
        .domino { 
            width: 40px; height: 80px; background: #f0f0f0; border-radius: 4px; display: flex; flex-direction: column;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.5); cursor: pointer; border: 1px solid #999; position: relative;
        }
        .domino.horizontal { transform: rotate(90deg); margin: 0 -20px; }
        .half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); padding: 5px; }
        .dot { background: #222; border-radius: 50%; width: 6px; height: 6px; visibility: hidden; align-self: center; justify-self: center; }
        .line { height: 1px; background: #ccc; width: 80%; margin: 0 auto; }
        
        /* ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· */
        .d-1 .dot:nth-child(5) { visibility: visible; }
        .d-2 .dot:nth-child(1), .d-2 .dot:nth-child(9) { visibility: visible; }
        .d-3 .dot:nth-child(1), .d-3 .dot:nth-child(5), .d-3 .dot:nth-child(9) { visibility: visible; }
        .d-4 .dot:nth-child(1), .d-4 .dot:nth-child(3), .d-4 .dot:nth-child(7), .d-4 .dot:nth-child(9) { visibility: visible; }
        .d-5 .dot:nth-child(1), .d-5 .dot:nth-child(3), .d-5 .dot:nth-child(5), .d-5 .dot:nth-child(7), .d-5 .dot:nth-child(9) { visibility: visible; }
        .d-6 .dot:nth-child(1), .d-6 .dot:nth-child(3), .d-6 .dot:nth-child(4), .d-6 .dot:nth-child(6), .d-6 .dot:nth-child(7), .d-6 .dot:nth-child(9) { visibility: visible; }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .controls { background: rgba(0,0,0,0.6); padding: 20px; border-radius: 30px 30px 0 0; }
        .hand { display: flex; gap: 10px; justify-content: center; overflow-x: auto; padding: 10px; height: 100px; }
        .btn-draw { background: var(--pi-orange); border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .modal-content { background: var(--bg-dark); border: 2px solid var(--pi-orange); padding: 30px; border-radius: 20px; text-align: center; }
    </style>
</head>
<body>

<div id="lobby">
    <div class="lobby-box">
        <h1 style="color:var(--pi-orange)">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        <p>Ø§Ù„Ø±Ù‡Ø§Ù†: 100 Ï€ | Ø§Ù„Ù‡Ø¯Ù: 101 Ù†Ù‚Ø·Ø©</p>
        <button class="btn-draw" onclick="startNewGame()" style="width:100%; font-size:1.2rem;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
    </div>
</div>

<div id="gameScreen">
    <div class="header">
        <div class="score-box">ğŸ‘¤ Ø£Ù†Øª: <span id="pTotal">0</span> | ğŸ¤– Ø§Ù„Ø®ØµÙ…: <span id="aiTotal">0</span></div>
        <div id="turnIndicator" style="color:var(--pi-orange)">Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†</div>
        <button onclick="location.reload()" style="background:red; border:none; color:white; border-radius:5px; padding:2px 10px;">Ø§Ù†Ø³Ø­Ø§Ø¨</button>
    </div>

    <div class="table-area">
        <div id="snake"></div>
    </div>

    <div class="controls">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <button class="btn-draw" id="drawBtn" onclick="playerDraw()">Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (<span id="boneCount">14</span>)</button>
            <div style="font-size:0.8rem">Ø§Ù„Ø£Ø·Ø±Ø§Ù: <span id="leftV">?</span> | <span id="rightV">?</span></div>
        </div>
        <div class="hand" id="playerHand"></div>
    </div>
</div>

<div id="winModal" class="modal">
    <div class="modal-content">
        <h2 id="roundWinner"></h2>
        <p id="roundPoints"></p>
        <button class="btn-draw" onclick="prepareNextRound()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
</div>

<script>
    let playerHand = [], aiHand = [], boneyard = [], table = [];
    let leftEnd = -1, rightEnd = -1;
    let scores = { player: 0, ai: 0 };

    function createDominoUI(a, b, isHorizontal = true) {
        const div = document.createElement('div');
        div.className = `domino ${isHorizontal ? 'horizontal' : ''}`;
        div.innerHTML = `
            <div class="half d-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div>
            <div class="line"></div>
            <div class="half d-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>
        `;
        return div;
    }

    function startNewGame() {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'flex';
        prepareNextRound();
    }

    function prepareNextRound() {
        document.getElementById('winModal').style.display = 'none';
        document.getElementById('snake').innerHTML = '';
        const deck = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) deck.push({a:i, b:j});
        deck.sort(() => Math.random() - 0.5);
        
        playerHand = deck.splice(0, 7);
        aiHand = deck.splice(0, 7);
        boneyard = deck;
        table = [];
        leftEnd = -1; rightEnd = -1;
        
        renderHand();
        updateUI();
    }

    function renderHand() {
        const handDiv = document.getElementById('playerHand');
        handDiv.innerHTML = '';
        playerHand.forEach((t, i) => {
            const el = createDominoUI(t.a, t.b, false);
            el.onclick = () => tryPlay(t, i);
            handDiv.appendChild(el);
        });
    }

    function tryPlay(tile, index) {
        let side = '';
        if (leftEnd === -1) side = 'first';
        else if (tile.a === leftEnd || tile.b === leftEnd) side = 'left';
        else if (tile.a === rightEnd || tile.b === rightEnd) side = 'right';

        if (!side) return alert("Ù‚Ø·Ø¹Ø© ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©!");

        // Ù…Ù†Ø·Ù‚ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‚Ø·Ø¹Ø© Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
        if (side === 'left') {
            if (tile.b !== leftEnd) [tile.a, tile.b] = [tile.b, tile.a];
            leftEnd = tile.a;
            table.unshift(tile);
        } else if (side === 'right' || side === 'first') {
            if (side !== 'first' && tile.a !== rightEnd) [tile.a, tile.b] = [tile.b, tile.a];
            rightEnd = tile.b;
            if(side === 'first') leftEnd = tile.a;
            table.push(tile);
        }

        playerHand.splice(index, 1);
        refreshTable();
        renderHand();
        if (playerHand.length === 0) return endRound('player');
        
        document.getElementById('turnIndicator').innerText = "Ø§Ù„Ø®ØµÙ… ÙŠÙÙƒØ±...";
        setTimeout(aiTurn, 1000);
    }

    function aiTurn() {
        const moveIdx = aiHand.findIndex(t => t.a === leftEnd || t.b === leftEnd || t.a === rightEnd || t.b === rightEnd);
        if (moveIdx !== -1) {
            const t = aiHand[moveIdx];
            if (t.a === leftEnd || t.b === leftEnd) {
                if (t.b !== leftEnd) [t.a, t.b] = [t.b, t.a];
                leftEnd = t.a; table.unshift(t);
            } else {
                if (t.a !== rightEnd) [t.a, t.b] = [t.b, t.a];
                rightEnd = t.b; table.push(t);
            }
            aiHand.splice(moveIdx, 1);
            refreshTable();
            if (aiHand.length === 0) return endRound('ai');
        } else if (boneyard.length > 0) {
            aiHand.push(boneyard.shift());
            updateUI();
            return aiTurn(); // ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­Ø¨
        }
        document.getElementById('turnIndicator').innerText = "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†";
    }

    function playerDraw() {
        if (boneyard.length > 0) {
            playerHand.push(boneyard.shift());
            renderHand();
            updateUI();
        }
    }

    function refreshTable() {
        const snakeDiv = document.getElementById('snake');
        snakeDiv.innerHTML = '';
        table.forEach(t => snakeDiv.appendChild(createDominoUI(t.a, t.b)));
        updateUI();
    }

    function updateUI() {
        document.getElementById('boneCount').innerText = boneyard.length;
        document.getElementById('pTotal').innerText = scores.player;
        document.getElementById('aiTotal').innerText = scores.ai;
        document.getElementById('leftV').innerText = leftEnd === -1 ? "?" : leftEnd;
        document.getElementById('rightV').innerText = rightEnd === -1 ? "?" : rightEnd;
    }

    function endRound(winner) {
        let points = 0;
        const loserHand = winner === 'player' ? aiHand : playerHand;
        loserHand.forEach(t => points += (t.a + t.b));
        
        scores[winner] += points;
        updateUI();

        document.getElementById('roundWinner').innerText = winner === 'player' ? "ÙØ²Øª Ø¨Ø§Ù„Ø¯ÙˆØ±! ğŸ‰" : "Ø®Ø³Ø±Øª Ø§Ù„Ø¯ÙˆØ± ğŸ¤–";
        document.getElementById('roundPoints').innerText = `Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯ÙˆØ±: ${points} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${scores[winner]}`;
        document.getElementById('winModal').style.display = 'flex';

        if (scores[winner] >= 101) {
            alert(`Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù†ØªÙ‡Øª! Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ ${winner === 'player' ? 'Ø£Ù†Øª' : 'Ø§Ù„Ø®ØµÙ…'}`);
            location.reload();
        }
    }
</script>
</body>
</html>
