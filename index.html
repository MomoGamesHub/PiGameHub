<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Game Hub - Sudoku & Domino</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --main-purple: #673ab7; --bg-light: #f4f7f6; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg-light); margin: 0; padding: 0; text-align: center; }
        .header { background: var(--main-purple); color: white; padding: 20px; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .container { padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .game-item { background: white; border-radius: 15px; padding: 10px; border: 2px solid transparent; transition: 0.3s; cursor: pointer; }
        .game-item:hover { border-color: var(--main-purple); transform: translateY(-5px); }
        .game-item img { width: 100%; border-radius: 10px; }
        .btn { background: var(--main-purple); color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        
        /* Sudoku Styling */
        #sudoku-board { display: grid; grid-template-columns: repeat(9, 1fr); gap: 2px; background: #444; border: 2px solid #444; margin: 15px auto; max-width: 330px; }
        .sudoku-cell { width: 100%; aspect-ratio: 1; background: white; border: none; text-align: center; font-size: 16px; font-weight: bold; padding: 0; }
        .sudoku-cell:focus { background: #e1f5fe; outline: none; }
        .fixed-cell { background: #eee; color: var(--main-purple); }
        
        /* Overlay */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; color: white; padding: 20px; }
    </style>
</head>
<body>

<div class="header">
    <h1>Pi Game Hub</h1>
    <p id="username-display">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...</p>
</div>

<div class="container">
    <div id="auth-section" class="card">
        <h3>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø¬ØªÙ…Ø¹ PiOS</h3>
        <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ù…ØªØµÙØ­ Pi Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨</p>
        <button class="btn" onclick="startPiAuth()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Pi</button>
    </div>

    <div id="game-dashboard" style="display:none;">
        <div class="card">
            <h4>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="user-balance" style="color:var(--main-purple)">0.00 Pi</span></h4>
        </div>
        
        <div class="game-grid">
            <div class="game-item" onclick="requestGamePayment('sudoku')">
                <img src="https://via.placeholder.com/150?text=Sudoku" alt="Sudoku">
                <p>Ø³ÙˆØ¯ÙˆÙƒÙˆ Ø°ÙƒÙŠØ©</p>
            </div>
            <div class="game-item" onclick="requestGamePayment('domino')">
                <img src="https://via.placeholder.com/150?text=Domino" alt="Domino">
                <p>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ø­ØªØ±Ø§ÙÙŠØ©</p>
            </div>
        </div>
    </div>

    <div id="sudoku-view" class="card" style="display:none;">
        <h3>ğŸ§© ØªØ­Ø¯ÙŠ Ø§Ù„Ø³ÙˆØ¯ÙˆÙƒÙˆ</h3>
        <div id="sudoku-board"></div>
        <button class="btn" onclick="checkSudoku()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù„</button>
        <button class="btn" style="background:#888;" onclick="backToDashboard()">Ø§Ù†Ø³Ø­Ø§Ø¨</button>
    </div>
</div>

<div id="pay-overlay" class="overlay">
    <div class="card" style="color:#333; width: 90%;">
        <h3>ØªÙ†Ø´ÙŠØ· Ø§Ù„Ù„Ø¹Ø¨Ø© âš¡</h3>
        <p>ÙŠØªØ·Ù„Ø¨ ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¯ÙØ¹ 0.1 Pi Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¯Ø¹Ù… Ù…Ø·ÙˆØ±ÙŠ PiOS.</p>
        <button class="btn" onclick="createPiPayment()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¯ÙØ¹ 0.1 Pi</button>
        <button class="btn" style="background:#ccc;" onclick="document.getElementById('pay-overlay').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
    const Pi = window.Pi;
    Pi.init({ version: "2.0", sandbox: true }); // Ø§Ø¬Ø¹Ù„ÙŠÙ‡Ø§ false Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ

    let currentUser = null;
    let selectedGame = '';

    async function startPiAuth() {
        try {
            const auth = await Pi.authenticate(['username', 'payments'], onIncompletePaymentFound);
            currentUser = auth.user.username;
            document.getElementById('username-display').innerText = "@" + currentUser;
            document.getElementById('auth-section').style.display = "none";
            document.getElementById('game-dashboard').style.display = "block";
        } catch (err) { alert("Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Pi Browser"); }
    }

    function requestGamePayment(game) {
        selectedGame = game;
        document.getElementById('pay-overlay').style.display = "flex";
    }

    async function createPiPayment() {
        try {
            await Pi.createPayment({
                amount: 0.1,
                memo: "ØªÙØ¹ÙŠÙ„ Ù„Ø¹Ø¨Ø© " + selectedGame,
                metadata: { game: selectedGame }
            }, {
                onReadyForServerApproval: (paymentId) => handleServer(paymentId, 'approve'),
                onReadyForServerCompletion: (paymentId, txid) => {
                    handleServer(paymentId, 'complete', txid);
                    document.getElementById('pay-overlay').style.display = 'none';
                    if(selectedGame === 'sudoku') launchSudoku();
                },
                onCancel: (pId) => {},
                onError: (err) => alert("ÙØ´Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©: " + err.message)
            });
        } catch (e) { alert("Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ"); }
    }

    async function handleServer(paymentId, action, txid = null) {
        return await fetch('/api/pi-handler', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId, action, txid })
        }).then(res => res.json());
    }

    function onIncompletePaymentFound(payment) {
        handleServer(payment.identifier, 'complete', payment.transaction.txid);
    }

    // --- Sudoku Logic ---
    function launchSudoku() {
        document.getElementById('game-dashboard').style.display = 'none';
        document.getElementById('sudoku-view').style.display = 'block';
        const board = document.getElementById('sudoku-board');
        board.innerHTML = '';
        const puzzle = [5,3,0,0,7,0,0,0,0,6,0,0,1,9,5,0,0,0,0,9,8,0,0,0,0,6,0,8,0,0,0,6,0,0,0,3,4,0,0,8,0,3,0,0,1,7,0,0,0,2,0,0,0,6,0,6,0,0,0,0,2,8,0,0,0,0,4,1,9,0,0,5,0,0,0,0,8,0,0,7,9];
        
        puzzle.forEach(num => {
            const cell = document.createElement('input');
            cell.type = 'number';
            cell.className = 'sudoku-cell';
            if(num !== 0) { cell.value = num; cell.readOnly = true; cell.classList.add('fixed-cell'); }
            board.appendChild(cell);
        });
    }

    function checkSudoku() {
        alert("Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹! Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù†Ù‚Ø§Ø·Ùƒ ÙÙŠ Ù…Ø­ÙØ¸Ø© PiOS Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
    }

    function backToDashboard() {
        document.getElementById('sudoku-view').style.display = 'none';
        document.getElementById('game-dashboard').style.display = 'block';
    }
</script>
</body>
</html>
