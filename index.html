<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ø§ÙŠ - Pi Games</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --main-purple: #673ab7; --accent-gold: #ffc107; }
        body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; margin: 0; padding: 0; overflow-x: hidden; }
        .header { background: linear-gradient(135deg, #673ab7, #512da8); color: white; padding: 30px 20px; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .container { padding: 20px; max-width: 500px; margin: auto; }
        .card { background: white; border-radius: 25px; padding: 20px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .game-item { background: #fff; border-radius: 20px; padding: 10px; border: 2px solid #eee; text-align: center; cursor: pointer; }
        .game-item img { width: 80px; height: 80px; margin-bottom: 10px; }
        .btn { background: var(--main-purple); color: white; border: none; padding: 15px; border-radius: 15px; font-weight: bold; width: 100%; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn:active { transform: scale(0.95); }
        
        /* Sudoku */
        #sudoku-board { display: grid; grid-template-columns: repeat(9, 1fr); gap: 1px; background: #333; border: 2px solid #333; margin: 20px auto; width: 100%; }
        .sudoku-cell { width: 100%; aspect-ratio: 1; background: white; border: none; text-align: center; font-size: 14px; font-weight: bold; -moz-appearance: textfield; }
        .sudoku-cell::-webkit-inner-spin-button, .sudoku-cell::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .fixed-cell { background: #eee; color: var(--main-purple); }
        
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0;">Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ø§ÙŠ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
    <p id="username-display" style="opacity: 0.9;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙØ¸Ø©...</p>
</div>

<div class="container">
    <div id="auth-section" class="card">
        <h3>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹! ğŸ‘‹</h3>
        <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ.</p>
        <button class="btn" onclick="startPiAuth()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† Ø¹Ø¨Ø± Pi</button>
    </div>

    <div id="game-dashboard" style="display:none;">
        <div class="card" style="border-right: 5px solid var(--accent-gold);">
            <p style="margin:0; color:#666;">Ø±ØµÙŠØ¯Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
            <h2 id="user-balance" style="margin:5px 0; color:var(--main-purple);">10.00 Pi Test</h2>
        </div>
        
        <h3>Ø§Ø®ØªØ± Ù„Ø¹Ø¨ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©:</h3>
        <div class="game-grid">
            <div class="game-item" onclick="requestPayment('sudoku')">
                <div style="font-size: 40px;">ğŸ§©</div>
                <p>Ø³ÙˆØ¯ÙˆÙƒÙˆ</p>
                <small style="color:var(--main-purple)">0.1 Pi</small>
            </div>
            <div class="game-item" onclick="requestPayment('domino')">
                <div style="font-size: 40px;">ğŸ²</div>
                <p>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ</p>
                <small style="color:#888">Ù‚Ø±ÙŠØ¨Ø§Ù‹</small>
            </div>
        </div>
    </div>

    <div id="sudoku-view" class="card" style="display:none;">
        <h3>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³ÙˆØ¯ÙˆÙƒÙˆ</h3>
        <div id="sudoku-board"></div>
        <button class="btn" onclick="checkSudoku()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ù„ âœ…</button>
        <button class="btn" style="background:#f1f1f1; color:#333; margin-top:10px;" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="pay-overlay" class="overlay">
    <div class="card" style="width:80%; text-align:center;">
        <div style="font-size:50px;">ğŸ’</div>
        <h3>ØªÙ†Ø´ÙŠØ· Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
        <p>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‡ÙŠ 0.1 Pi. Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø¨Ø¯Ø¡ØŸ</p>
        <button class="btn" onclick="confirmAndPay()">Ù†Ø¹Ù…ØŒ Ø£Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†</button>
        <p onclick="document.getElementById('pay-overlay').style.display='none'" style="color:red; cursor:pointer; margin-top:15px;">Ø¥Ù„ØºØ§Ø¡</p>
    </div>
</div>

<script>
    const Pi = window.Pi;
    Pi.init({ version: "2.0", sandbox: true });

    let activeGame = '';

    async function startPiAuth() {
        try {
            const auth = await Pi.authenticate(['username', 'payments'], onIncompletePaymentFound);
            document.getElementById('username-display').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + auth.user.username;
            document.getElementById('auth-section').style.display = "none";
            document.getElementById('game-dashboard').style.display = "block";
        } catch (err) {
            alert("ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ù…ØªØµÙØ­ Ø¨Ø§ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ.");
        }
    }

    function requestPayment(game) {
        if(game === 'domino') return alert("Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ­Øª Ø§Ù„ØªØ·ÙˆÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹.");
        activeGame = game;
        document.getElementById('pay-overlay').style.display = 'flex';
    }

    async function confirmAndPay() {
        try {
            const payment = await Pi.createPayment({
                amount: 0.1,
                memo: "Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø¨Ø© " + activeGame,
                metadata: { game: activeGame }
            }, {
                onReadyForServerApproval: (pId) => handleServer(pId, 'approve'),
                onReadyForServerCompletion: (pId, txid) => {
                    handleServer(pId, 'complete', txid);
                    document.getElementById('pay-overlay').style.display = 'none';
                    if(activeGame === 'sudoku') startGame();
                },
                onCancel: (pId) => {},
                onError: (err) => alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯ÙØ¹")
            });
        } catch (e) { alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©"); }
    }

    async function handleServer(paymentId, action, txid = null) {
        return await fetch('/api/pi-handler', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId, action, txid })
        }).then(res => res.json());
    }

    function onIncompletePaymentFound(p) { handleServer(p.identifier, 'complete', p.transaction.txid); }

    function startGame() {
        document.getElementById('game-dashboard').style.display = 'none';
        document.getElementById('sudoku-view').style.display = 'block';
        const board = document.getElementById('sudoku-board');
        board.innerHTML = '';
        // Ø´Ø¨ÙƒØ© Ù…Ø¨Ø³Ø·Ø©
        const puzzle = [5,3,0,0,7,0,0,0,0,6,0,0,1,9,5,0,0,0,0,9,8,0,0,0,0,6,0,8,0,0,0,6,0,0,0,3,4,0,0,8,0,3,0,0,1,7,0,0,0,2,0,0,0,6,0,6,0,0,0,0,2,8,0,0,0,0,4,1,9,0,0,5,0,0,0,0,8,0,0,7,9];
        puzzle.forEach(num => {
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'sudoku-cell';
            if(num !== 0) { input.value = num; input.readOnly = true; input.classList.add('fixed-cell'); }
            board.appendChild(input);
        });
    }

    function checkSudoku() { alert("ØªÙ… ÙØ­Øµ Ø§Ù„Ø­Ù„ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨!"); }
</script>
</body>
</html>
