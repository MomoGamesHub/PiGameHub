<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PiGamesHub | Official Mainnet Edition</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        :root { --gold: #ffd700; --purple: #6741d9; --bg: #05010a; --glass: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ© */
        .hero-bg {
            position: fixed; inset: 0;
            background: linear-gradient(rgba(5,1,10,0.8), rgba(5,1,10,0.8)), url('1000106337.png');
            background-size: cover; z-index: -1;
        }

        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--gold); }
        .pi-btn { background: linear-gradient(45deg, var(--purple), #4b2cb3); border: 1px solid var(--gold); color: white; padding: 10px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; }

        .hub { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px; max-width: 450px; margin: auto; }
        .card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; text-align: center; backdrop-filter: blur(10px); }
        .card img { width: 60px; height: 60px; margin-bottom: 10px; border-radius: 12px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        #arena { display: none; position: fixed; inset: 0; background: radial-gradient(circle, #0e4d26, #051a0d); z-index: 1000; flex-direction: column; }
        .board { flex: 1; display: flex; flex-wrap: wrap; align-content: center; justify-content: center; gap: 8px; padding: 20px; overflow: auto; }
        .hand { height: 130px; background: rgba(0,0,0,0.9); border-top: 3px solid var(--gold); display: flex; justify-content: center; align-items: center; gap: 10px; }

        /* Ù‚Ø·Ø¹ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© */
        .tile { width: 38px; height: 76px; background: white; border: 2px solid #000; border-radius: 5px; display: flex; flex-direction: column; flex-shrink: 0; }
        .half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); padding: 3px; }
        .dot { background: #000; border-radius: 50%; width: 5px; height: 5px; visibility: hidden; margin: auto; }
        .v1 .d5, .v3 .d5, .v5 .d5 { visibility: visible; }
        .v2 .d1, .v2 .d9, .v3 .d1, .v3 .d9, .v4 .d1, .v4 .d3, .v4 .d7, .v4 .d9, .v5 .d1, .v5 .d3, .v5 .d7, .v5 .d9, .v6 .d1, .v6 .d3, .v6 .d4, .v6 .d6, .v6 .d7, .v6 .d9 { visibility: visible; }
        .rotated { transform: rotate(90deg); margin: 0 -14px; }
    </style>
</head>
<body>

<div class="hero-bg"></div>

<div id="home">
    <header>
        <div style="color:var(--gold); font-weight:bold;">PiGamesHub</div>
        <button class="pi-btn" onclick="authPi()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ $\pi$</button>
    </header>

    <div style="text-align: center; padding: 20px;">
        <button class="pi-btn" style="background: #28a745;" onclick="transferPi()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ø¯ÙØ¹ 0.1 $\pi$)</button>
    </div>

    <div class="hub">
        <div class="card" onclick="openDomino()"><img src="1000106355.png"><div>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ</div></div>
        <div class="card"><img src="1000106337.png"><div>Ø´Ø·Ø±Ù†Ø¬</div></div>
        <div class="card"><img src="1000110182.jpg"><div>Ù„ÙˆØ¯Ùˆ</div></div>
        <div class="card"><img src="1000106337.png"><div>ÙƒÙˆØªØ´ÙŠÙ†Ø©</div></div>
        <div class="card"><img src="1000106355.png"><div>Ù†Ø±Ø¯</div></div>
        <div class="card"><img src="1000110182.jpg"><div>Ø·Ø§ÙˆÙ„Ø© 31</div></div>
    </div>
</div>

<div id="arena">
    <div style="padding:10px; background:rgba(0,0,0,0.8); display:flex; justify-content:space-between;">
        <button onclick="location.reload()" style="border:1px solid var(--gold); background:none; color:var(--gold); padding:5px 15px; border-radius:10px;">ğŸ  Ø®Ø±ÙˆØ¬</button>
        <span id="score">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ù…Ø­ØªØ±Ù</span>
    </div>
    <div class="board" id="game-board"></div>
    <div class="hand" id="player-hand"></div>
</div>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Pi SDK Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const Pi = window.Pi;
    Pi.init({ version: "2.0", sandbox: true }); // Ø§Ø¬Ø¹Ù„ sandbox: false Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ

    async function authPi() {
        try {
            const scopes = ['username', 'payments'];
            const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
            alert("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ: " + auth.user.username);
        } catch (err) { alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: " + err); }
    }

    function onIncompletePaymentFound(payment) { /* Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© */ }

    // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯ÙØ¹ Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠØ©
    async function transferPi() {
        try {
            const payment = await Pi.createPayment({
                amount: 0.1,
                memo: "ØªÙØ¹ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ PiGamesHub",
                metadata: { userId: "pioneer_1" }
            }, {
                onReadyForServerApproval: (paymentId) => { console.log("Approved: " + paymentId); },
                onReadyForServerCompletion: (paymentId, txid) => { 
                    alert("ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ø§Ø¬Ø¹ ØµÙØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø§Ù„Ø¢Ù†.");
                },
                onCancel: (paymentId) => { console.log("Canceled"); },
                onError: (error, payment) => { console.error(error); }
            });
        } catch (err) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: " + err.message); }
    }

    // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ù…Ø³ØªÙ‚Ø±
    let myTiles = [], board = [];

    function openDomino() {
        document.getElementById('home').style.display = 'none';
        document.getElementById('arena').style.display = 'flex';
        let d = []; for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) d.push([i,j]);
        d.sort(() => Math.random() - 0.5);
        myTiles = d.splice(0, 7);
        render();
    }

    function createTileHTML(v1, v2, isRot = false) {
        let dots = '<div class="dot d1"></div><div class="dot d2"></div><div class="dot d3"></div><div class="dot d4"></div><div class="dot d5"></div><div class="dot d6"></div><div class="dot d7"></div><div class="dot d8"></div><div class="dot d9"></div>';
        return `<div class="tile ${isRot ? 'rotated' : ''}"><div class="half v${v1}">${dots}</div><div style="height:1px;background:#eee;"></div><div class="half v${v2}">${dots}</div></div>`;
    }

    function render() {
        const h = document.getElementById('player-hand'); h.innerHTML = '';
        myTiles.forEach((t, i) => {
            let div = document.createElement('div'); div.innerHTML = createTileHTML(t[0], t[1]);
            div.onclick = () => play(i); h.appendChild(div);
        });
        const b = document.getElementById('game-board'); b.innerHTML = '';
        board.forEach(t => {
            let div = document.createElement('div'); div.innerHTML = createTileHTML(t[0], t[1], t[0] !== t[1]);
            b.appendChild(div);
        });
    }

    function play(idx) {
        let t = myTiles[idx];
        if(board.length === 0) board.push(t);
        else {
            let L = board[0][0], R = board[board.length-1][1];
            if(t.includes(L)) board.unshift(t[1] === L ? t : [t[1], t[0]]);
            else if(t.includes(R)) board.push(t[0] === R ? t : [t[1], t[0]]);
            else return;
        }
        myTiles.splice(idx, 1); render();
    }
</script>
</body>
</html>
