<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† | Ù†Ø¸Ø§Ù… Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        :root { --pi-gold: #ffcf33; --table-green: #074e36; --bone-white: #f8f9fa; }
        
        body { font-family: 'Cairo', sans-serif; background: #0b0b1a; color: white; margin: 0; overflow: hidden; }

        /* Ø§Ù„Ø·Ø§ÙˆÙ„Ø© */
        #gameArea { height: 100vh; display: flex; flex-direction: column; background: radial-gradient(circle, #0a5c43 0%, #052c21 100%); }
        
        .header { display: flex; justify-content: space-between; padding: 10px 20px; background: rgba(0,0,0,0.5); border-bottom: 2px solid var(--pi-gold); z-index: 100; }
        .score-pills { display: flex; gap: 10px; font-weight: bold; }
        .pill { background: var(--pi-gold); color: #000; padding: 2px 12px; border-radius: 15px; font-size: 0.9rem; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø§Ù„Ù…Ø­ØªØ±ÙØ© */
        .table-container { 
            flex: 1; overflow: auto; display: flex; align-items: center; justify-content: center; 
            padding: 100px; scroll-behavior: smooth;
        }
        #snakeChain { 
            display: flex; align-items: center; gap: 4px; padding: 20px;
            min-width: max-content; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .domino { 
            width: 38px; height: 76px; background: var(--bone-white); border-radius: 5px; 
            display: flex; flex-direction: column; box-shadow: 3px 5px 10px rgba(0,0,0,0.4);
            border: 1px solid #aaa; flex-shrink: 0; position: relative; transform: rotate(90deg); /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
        }
        .half { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); padding: 5px; pointer-events: none; }
        .dot { background: #111; border-radius: 50%; width: 6px; height: 6px; visibility: hidden; align-self: center; justify-self: center; }
        .divider { height: 2px; background: #333; width: 80%; margin: 0 auto; opacity: 0.2; }
        
        /* Ø§Ù„Ù†Ù‚Ø§Ø· */
        .d-1 .dot:nth-child(5) { visibility: visible; }
        .d-2 .dot:nth-child(1), .d-2 .dot:nth-child(9) { visibility: visible; }
        .d-3 .dot:nth-child(1), .d-3 .dot:nth-child(5), .d-3 .dot:nth-child(9) { visibility: visible; }
        .d-4 .dot:nth-child(1), .d-4 .dot:nth-child(3), .d-4 .dot:nth-child(7), .d-4 .dot:nth-child(9) { visibility: visible; }
        .d-5 .dot:nth-child(1), .d-5 .dot:nth-child(3), .d-5 .dot:nth-child(5), .d-5 .dot:nth-child(7), .d-5 .dot:nth-child(9) { visibility: visible; }
        .d-6 .dot:nth-child(1), .d-6 .dot:nth-child(3), .d-6 .dot:nth-child(4), .d-6 .dot:nth-child(6), .d-6 .dot:nth-child(7), .d-6 .dot:nth-child(9) { visibility: visible; }

        /* Ù…Ù†Ø·Ù‚Ø© ÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ */
        .player-zone { background: rgba(0,0,0,0.8); padding: 15px; border-top: 3px solid var(--pi-gold); }
        .hand { display: flex; gap: 12px; justify-content: center; height: 90px; perspective: 500px; }
        .hand .domino { transform: rotate(0deg); cursor: pointer; }
        .hand .domino:hover { transform: translateY(-15px) scale(1.1); z-index: 10; border-color: var(--pi-gold); }

        .controls { display: flex; justify-content: space-between; align-items: center; max-width: 800px; margin: 0 auto 10px auto; }
        .btn { background: var(--pi-gold); border: none; padding: 8px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:disabled { background: #444; color: #888; cursor: not-allowed; }
        
        .status-badge { background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; border: 1px solid rgba(255,165,0,0.3); }
    </style>
</head>
<body>

<div id="gameArea">
    <div class="header">
        <div class="score-pills">
            <div class="pill">ğŸ‘¤ <span id="pScore">0</span></div>
            <div class="pill">ğŸ¤– <span id="aiScore">0</span></div>
        </div>
        <div class="status-badge" id="statusMsg">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©...</div>
        <div class="status-badge" style="color:var(--pi-gold)">Ø§Ù„Ù‡Ø¯Ù: 101</div>
    </div>

    <div class="table-container" id="scrollContainer">
        <div id="snakeChain">
            </div>
    </div>

    <div class="player-zone">
        <div class="controls">
            <button id="drawBtn" class="btn" onclick="playerAction('draw')">Ø³Ø­Ø¨ (<span id="boneCount">14</span>)</button>
            <div id="endsInfo" style="font-size: 0.9rem;">Ø§Ù„Ø£Ø·Ø±Ø§Ù: <b id="lV">?</b> | <b id="rV">?</b></div>
            <button id="passBtn" class="btn" onclick="playerAction('pass')" disabled>ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±</button>
        </div>
        <div class="hand" id="playerHand"></div>
    </div>
</div>

<script>
    let pHand = [], aiHand = [], boneyard = [], tableChain = [];
    let lVal = -1, rVal = -1, scores = { p: 0, ai: 0 };

    function createDomino(a, b) {
        const d = document.createElement('div');
        d.className = 'domino';
        d.innerHTML = `<div class="half d-${a}">${Array(9).fill('<div class="dot"></div>').join('')}</div><div class="divider"></div><div class="half d-${b}">${Array(9).fill('<div class="dot"></div>').join('')}</div>`;
        return d;
    }

    function initGame() {
        const deck = [];
        for(let i=0; i<=6; i++) for(let j=i; j<=6; j++) deck.push({a:i, b:j});
        deck.sort(() => Math.random() - 0.5);
        
        pHand = deck.splice(0, 7);
        aiHand = deck.splice(0, 7);
        boneyard = deck;
        tableChain = []; lVal = -1; rVal = -1;
        
        refreshUI();
        msg("Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù† - Ø§Ù„Ø¹Ø¨ Ù‚Ø·Ø¹Ø© Ù…Ø·Ø§Ø¨Ù‚Ø©");
    }

    function refreshUI() {
        const h = document.getElementById('playerHand');
        h.innerHTML = '';
        pHand.forEach((t, i) => {
            const el = createDomino(t.a, t.b);
            el.onclick = () => playTile(i);
            h.appendChild(el);
        });

        const s = document.getElementById('snakeChain');
        s.innerHTML = '';
        tableChain.forEach(t => s.appendChild(createDomino(t.a, t.b)));

        document.getElementById('lV').innerText = lVal === -1 ? 'ØŸ' : lVal;
        document.getElementById('rV').innerText = rVal === -1 ? 'ØŸ' : rVal;
        document.getElementById('boneCount').innerText = boneyard.length;
        document.getElementById('pScore').innerText = scores.p;
        document.getElementById('aiScore').innerText = scores.ai;

        checkGameStatus();
    }

    function playTile(idx) {
        let t = pHand[idx];
        let side = '';

        if (lVal === -1) side = 'first';
        else if (t.a === lVal || t.b === lVal) side = 'left';
        else if (t.a === rVal || t.b === rVal) side = 'right';

        if (!side) return;

        if (side === 'left') {
            if (t.b !== lVal) [t.a, t.b] = [t.b, t.a];
            lVal = t.a; tableChain.unshift(t);
        } else {
            if (side !== 'first' && t.a !== rVal) [t.a, t.b] = [t.b, t.a];
            rVal = t.b; if(side === 'first') lVal = t.a;
            tableChain.push(t);
        }

        pHand.splice(idx, 1);
        refreshUI();
        if (pHand.length === 0) return endRound('player');
        
        msg("Ø§Ù„Ø®ØµÙ… ÙŠÙÙƒØ±...");
        setTimeout(aiMove, 800);
    }

    function aiMove() {
        let idx = aiHand.findIndex(t => t.a === lVal || t.b === lVal || t.a === rVal || t.b === rVal);
        
        if (idx === -1 && boneyard.length > 0) {
            aiHand.push(boneyard.shift());
            refreshUI();
            return setTimeout(aiMove, 500);
        }

        if (idx !== -1) {
            let t = aiHand[idx];
            if (t.a === lVal || t.b === lVal) {
                if (t.b !== lVal) [t.a, t.b] = [t.b, t.a];
                lVal = t.a; tableChain.unshift(t);
            } else {
                if (t.a !== rVal) [t.a, t.b] = [t.b, t.a];
                rVal = t.b; tableChain.push(t);
            }
            aiHand.splice(idx, 1);
            refreshUI();
            if (aiHand.length === 0) return endRound('ai');
            msg("Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†");
        } else {
            msg("Ø§Ù„Ø®ØµÙ… Ù…Ø±Ø± Ø§Ù„Ø¯ÙˆØ±!");
        }
    }

    function checkGameStatus() {
        const pCanPlay = pHand.some(t => t.a === lVal || t.b === lVal || t.a === rVal || t.b === rVal || lVal === -1);
        const aiCanPlay = aiHand.some(t => t.a === lVal || t.b === lVal || t.a === rVal || t.b === rVal);
        
        document.getElementById('passBtn').disabled = (pCanPlay || boneyard.length > 0);
        
        // Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù‚ÙÙ„Ø© (Block)
        if (!pCanPlay && !aiCanPlay && boneyard.length === 0) {
            handleBlock();
        }
    }

    function handleBlock() {
        let pSum = pHand.reduce((acc, t) => acc + t.a + t.b, 0);
        let aiSum = aiHand.reduce((acc, t) => acc + t.a + t.b, 0);
        
        msg(`Ù‚ÙÙ„Ø©! Ø£Ù†Øª: ${pSum} | Ø§Ù„Ø®ØµÙ…: ${aiSum}`);
        setTimeout(() => {
            if (pSum < aiSum) endRound('player', aiSum);
            else if (aiSum < pSum) endRound('ai', pSum);
            else alert("ØªØ¹Ø§Ø¯Ù„ ÙÙŠ Ø§Ù„Ù‚ÙÙ„Ø©!");
        }, 2000);
    }

    function endRound(winner) {
        let pts = 0;
        if (winner === 'player') aiHand.forEach(t => pts += (t.a + t.b));
        else pHand.forEach(t => pts += (t.a + t.b));
        
        scores[winner === 'player' ? 'p' : 'ai'] += pts;
        alert(`Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±! Ø§Ù„ÙØ§Ø¦Ø²: ${winner === 'player' ? 'Ø£Ù†Øª' : 'Ø§Ù„Ø®ØµÙ…'}\nÙ†Ù‚Ø§Ø· Ø§Ù„Ø¯ÙˆØ±: ${pts}`);
        
        if (scores.p >= 101 || scores.ai >= 101) {
            alert("Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù†ØªÙ‡Øª ÙÙˆØ² " + (scores.p >= 101 ? "Ø§Ù„Ù„Ø§Ø¹Ø¨" : "Ø§Ù„Ø®ØµÙ…"));
            scores = { p:0, ai:0 };
        }
        initGame();
    }

    function playerAction(type) {
        if (type === 'draw' && boneyard.length > 0) {
            pHand.push(boneyard.shift());
            refreshUI();
        } else if (type === 'pass') {
            msg("Ù„Ù‚Ø¯ Ù…Ø±Ø±Øª Ø§Ù„Ø¯ÙˆØ±");
            setTimeout(aiMove, 600);
        }
    }

    function msg(m) { document.getElementById('statusMsg').innerText = m; }

    initGame();
</script>
</body>
</html>
