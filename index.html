<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>PiGameHub â€“ Free Play</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {margin:0; padding:0; font-family:'Comic Sans MS', cursive, sans-serif;
        background: linear-gradient(160deg,#1a1a2e,#000); color:#fff; text-align:center;}
  h1 {margin-top:20px; font-size:32px; color:#0ff; animation: glow 2s ease-in-out infinite alternate;}
  @keyframes glow {0%{text-shadow:0 0 5px #0ff;}100%{text-shadow:0 0 25px #0ff,0 0 50px #0ff;}}
  .login {margin:20px;}
  input {padding:10px; font-size:16px; border-radius:8px; border:none; margin-right:10px;}
  button {padding:10px 20px; font-size:16px; border-radius:8px; border:none; cursor:pointer; background:#0ff; color:#000;}
  .avatars {display:flex; justify-content:center; flex-wrap:wrap; gap:15px; margin:20px auto;}
  .avatar {width:80px; height:80px; border-radius:50%; background:#222; display:flex; align-items:center; justify-content:center; font-size:36px; cursor:pointer; transition: transform 0.3s, box-shadow 0.3s;}
  .avatar:hover {transform:scale(1.2); box-shadow:0 0 15px #0ff;}
  .cards {display:flex; flex-wrap:wrap; justify-content:center; margin:20px auto; max-width:900px;}
  .card {width:70px; height:120px; background:#333; margin:10px; border-radius:10px; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:18px; color:#0ff; cursor:pointer; transition: transform 0.3s, box-shadow 0.3s, background 0.3s;}
  .card:hover {transform:translateY(-10px); box-shadow:0 10px 20px rgba(0,255,255,0.6);}
  .count {font-size:12px; color:#0f0;} .points {font-size:14px; color:#ff0; font-weight:bold;}
</style>
</head>
<body>

<h1>ğŸ® PiGameHub â€“ Free Play</h1>
<p>Ø§Ø®ØªØ± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ù€ Wallet Ø£Ùˆ Ø±Ù‚Ù…Ùƒ/Ù…Ø­ÙØ¸Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</p>

<div class="login">
  <input type="text" id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ÙØ¸Ø© Ø£Ùˆ Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
  <button id="metaMaskBtn">Connect MetaMask</button>
</div>

<div class="avatars" id="avatars">
  <div class="avatar">ğŸ™‚</div>
  <div class="avatar">ğŸ˜</div>
  <div class="avatar">ğŸ§‘</div>
  <div class="avatar">ğŸ§™â€â™‚ï¸</div>
  <div class="avatar">ğŸ‘¾</div>
</div>

<div class="cards" id="cards"></div>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.9.1/dist/ethers.umd.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCn581B_OaIYc7crz3V2Lrjf9WOtJdRe60",
  authDomain: "pigameshub.firebaseapp.com",
  databaseURL: "https://pigameshub-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "pigameshub",
  storageBucket: "pigameshub.appspot.com",
  messagingSenderId: "977510299690",
  appId: "1:977510299690:web:2e146161feeeefb5486b53",
  measurementId: "G-CGKZZK48G4"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Web3 & Flexible Login
let userId = null; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
let provider = null;

async function connectMetaMask() {
  if(typeof window.ethereum!=='undefined'){
    provider = new ethers.BrowserProvider(window.ethereum);
    try{
      const accounts = await provider.send("eth_requestAccounts", []);
      userId = accounts[0];
      const network = await provider.getNetwork();
      alert(`ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${userId}\nØ§Ù„Ø´Ø¨ÙƒØ©: ${network.name}`);
    } catch(e){alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©"); console.error(e);}
  } else alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ«Ø¨ÙŠØª MetaMask");
}

// Ø²Ø± MetaMask
document.getElementById('metaMaskBtn').onclick = connectMetaMask;

// Ø²Ø± Login Ù…Ø±Ù†
document.getElementById('loginBtn').onclick = ()=>{
  const input = document.getElementById('userInput').value.trim();
  if(!input){alert("Ø§ÙƒØªØ¨ Ù…Ø­ÙØ¸Ø© Ø£Ùˆ Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„!"); return;}
  userId = input;
  alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€: ${userId}`);
};

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§ÙØ§ØªØ§Ø±
const avatars = document.querySelectorAll('.avatar');
let selectedAvatar = null;
avatars.forEach(av=>{
  av.onclick=()=>{
    avatars.forEach(a=>a.style.border="");
    av.style.border="3px solid #0ff";
    selectedAvatar = av.innerText;
    alert(`Ø§Ø®ØªØ±Øª Ø´Ø®ØµÙŠØªÙƒ: ${selectedAvatar}`);
  }
});

// Cards Free Play
const cardsContainer = document.getElementById("cards");
for(let i=1;i<=28;i++){
  const card = document.createElement("div");
  card.className="card";
  card.innerHTML=`<div>${i}</div><div class="count">0</div><div class="points">0</div>`;
  const countDiv = card.querySelector(".count");
  const pointsDiv = card.querySelector(".points");

  const updateColor=(points)=>{
    if(points<5) card.style.background="#1a8";
    else if(points<15) card.style.background="#fa0";
    else card.style.background="#f33";
  }

  card.onclick = async ()=>{
    if(!userId){alert("Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!"); return;}
    if(!selectedAvatar){alert("Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© Ø£ÙˆÙ„Ø§Ù‹"); return;}

    const cardRef = ref(db,'cards/'+i+'/'+userId);
    const snapshot = await get(cardRef);

    let count=1, totalPoints=0;
    if(snapshot.exists()){
      const data = snapshot.val();
      count = data.count+1;
      totalPoints = data.points;
    }

    // Ù†Ù‚Ø§Ø· Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨ÙŠÙ† 1 Ùˆ10
    const earnedPoints = Math.floor(Math.random()*10)+1;
    totalPoints += earnedPoints;

    const now = new Date().toLocaleString("ar-EG",{hour12:false});

    await set(cardRef,{
      count: count,
      points: totalPoints,
      lastClick: now,
      avatar: selectedAvatar
    });

    countDiv.innerText = count;
    pointsDiv.innerText = totalPoints;
    updateColor(totalPoints);

    alert(`ÙƒØ§Ø±Øª ${i} Ø¶ØºØ·Øª!\nØ¹Ø¯Ø¯ Ø§Ù„Ø¶ØºØ·Ø§Øª: ${count}\nÙ†Ù‚Ø§Ø· Ù…ÙƒØªØ³Ø¨Ø©: ${earnedPoints}\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·: ${totalPoints}\nØ§Ù„ÙˆÙ‚Øª: ${now}`);
  }

  cardsContainer.appendChild(card);
}
</script>
</body>
</html>
